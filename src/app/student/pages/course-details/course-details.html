<div class="course-details">
  <div *ngIf="assignmentSuccessMessage" class="top-alert-success">
    {{ assignmentSuccessMessage }}
  </div>

  <button class="back-btn" (click)="goBack()">← Back to Courses</button>

  <h1>{{ course.title }}</h1>
  <p class="description">{{ course.description }}</p>

  <div class="publish-box">
    <span>Status:
      <strong [class.published]="course.published" [class.draft]="!course.published">
        {{ course.published ? 'Published' : 'Draft' }}
      </strong>
    </span>
    <button (click)="togglePublish()">
      {{ course.published ? 'Unpublish' : 'Publish Course' }}
    </button>
  </div>

  <div class="tabs">
    <button (click)="activeTab='content'" [class.active]="activeTab==='content'">Content</button>
    <button (click)="activeTab='assignments'" [class.active]="activeTab==='assignments'">Assignments</button>
    <button (click)="activeTab='progress'" [class.active]="activeTab==='progress'">Progress</button>
    <button (click)="activeTab='quiz'" [class.active]="activeTab==='quiz'">Quiz</button>
  </div>

  <div *ngIf="activeTab==='content'">
    <div>
      <div class="card-header">
        <h3>Course Content</h3>
        <div>
          <button class="btn primary" (click)="openContentModal()">Add Video</button>
        </div>
      </div>
    </div>

    <div class="card-list">
      <div *ngIf="contentVideos.length === 0" class="card" style="padding:12px;">No content yet. Add YouTube links above.</div>

      <div *ngFor="let v of contentVideos; let i = index" class="video-item card">
        <div class="video-row">
          <div class="thumb">
            <img [src]="'https://img.youtube.com/vi/' + v.id + '/hqdefault.jpg'" alt="thumbnail">
          </div>

          <div class="meta">
            <div class="video-title">
              <label>{{ v.title }}</label>
            </div>
            <div class="video-desc">
              <small>{{ v.description }}</small>
            </div>
          </div>

          <div class="actions">
            <button class="btn-danger" (click)="removeContentVideo(i)">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Modal -->
    <div class="modal-backdrop" *ngIf="showContentModal" (click)="closeContentModal()"></div>
    <div class="modal" *ngIf="showContentModal" role="dialog" aria-modal="true">
      <div class="modal-content">
        <button class="modal-close" aria-label="Close" (click)="closeContentModal()">×</button>
        <h3>Add YouTube Video</h3>

        <label>Video Title</label>
        <input type="text" [(ngModel)]="newVideoTitle" placeholder="Enter video title" />

        <label>Add YouTube Video URL</label>
        <input type="text" [(ngModel)]="newVideoUrl" placeholder="https://youtu.be/... or https://www.youtube.com/watch?v=..." />

        <div class="modal-actions">
          <button class="btn-primary" (click)="addContentVideo()">Add Video</button>
          <button class="btn" (click)="closeContentModal()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab==='assignments'">
    <div>
      <div class="card-header">
        <h3>Assignments</h3>
        <div>
          <button class="btn primary" (click)="openAssignmentModal()">Add Assignment</button>
        </div>
      </div>
    </div>

    <div class="card-list">
      <div *ngIf="courseDetailsService.assignments.length === 0" class="card" style="padding:12px;">No assignments yet. Click Add Assignment to create one.</div>

      <div *ngFor="let assignment of courseDetailsService.assignments; let i = index" class="assignment-row card">
        <div class="assignment-info">
          <div class="assignment-title">{{ assignment.title }}</div>
          <div class="assignment-desc">{{ assignment | json | slice:0:1 }}{{ 'description' in assignment ? assignment['description'] : 'No description' }}</div>
        </div>
        <div class="assignment-meta">
          <div class="assignment-date">Due: {{ assignment.dueDate }}</div>
          <div class="assignment-actions">
            <button class="btn" (click)="openAssignmentModal(i)">Modify</button>
            <button class="btn-delete" (click)="deleteAssignment(i)">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Assignment Modal -->
    <div class="modal-backdrop" *ngIf="showAssignmentModal" (click)="closeAssignmentModal()"></div>
    <div class="modal" *ngIf="showAssignmentModal" role="dialog" aria-modal="true">
      <div class="modal-content">
        <button class="modal-close" aria-label="Close" (click)="closeAssignmentModal()">×</button>
        <h3>{{ editingAssignmentIndex !== null ? 'Edit Assignment' : 'Add Assignment' }}</h3>

        <label>Title</label>
        <input type="text" [(ngModel)]="assignForm.title" placeholder="Assignment title" />

        <label>Description</label>
        <textarea [(ngModel)]="assignForm.description" placeholder="Short description"></textarea>

        <label>Due Date</label>
        <input type="date" [(ngModel)]="assignForm.dueDate" class="date-picker" />

        <div class="modal-actions">
          <button class="btn-primary" (click)="saveAssignment()">Save</button>
          <button class="btn" (click)="closeAssignmentModal()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'quiz'">
    <div class="card">
      <div class="card-header">
        <h3>Quizzes</h3>
        <div>
          <button class="btn primary" (click)="navigateToCreateQuiz()">Create New Quiz</button>
        </div>
      </div>
    </div>

    <div class="card-list">
      <div *ngIf="courseDetailsService.quiz.questions.length === 0" class="card" style="padding:12px;">No quizzes yet. Click Create New Quiz to add one.</div>

      <div *ngFor="let q of courseDetailsService.quiz.questions; let qi = index" class="quiz-row card">
        <div class="quiz-info">
          <div class="quiz-title">Q{{ qi + 1 }}: {{ q.split(' | ')[0] }}</div>
          <div class="quiz-answer"><strong>Correct:</strong> {{ q.split(' | Correct: ')[1] }}</div>
        </div>
        <div class="quiz-actions">
          <button class="btn-delete" (click)="deleteQuizQuestion(qi)">Delete</button>
        </div>
      </div>
    </div>
  </div>

</div>
