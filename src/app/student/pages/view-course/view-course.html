<div class="course-details">
  <div *ngIf="assignmentSuccessMessage" class="top-alert-success">
    {{ assignmentSuccessMessage }}
  </div>

  <div *ngIf="contentSuccessMessage" class="top-alert-success">
    {{ contentSuccessMessage }}
  </div>

  <div *ngIf="contentErrorMessage" class="top-alert-error">
    {{ contentErrorMessage }}
  </div>

  <button class="back-btn" (click)="goBack()">‚Üê Back to Courses</button>

  <h1>{{ course?.name }}</h1>
  <p class="description">{{ course?.description }}</p>

  <div class="publish-box" *ngIf="course?.name">
    <span>Status:
      <strong [class.published]="course?.status === 'APPROVED'" [class.draft]="course?.status !== 'APPROVED'">
        {{ course?.status }}
      </strong>
    </span>
  </div>

  <div class="tabs">
    <button (click)="activeTab='content'" [class.active]="activeTab==='content'">Content</button>
    <button (click)="activeTab='assignments'" [class.active]="activeTab==='assignments'">Assignments</button>
    <button (click)="activeTab='progress'" [class.active]="activeTab==='progress'">Progress</button>
    <button (click)="activeTab='quiz'" [class.active]="activeTab==='quiz'">Quiz</button>
  </div>

  <div *ngIf="activeTab==='content'">
    <div class="card-header">
      <h3>Course Content</h3>
    </div>
    <div class="card-list">
      <div *ngIf="contentVideos && contentVideos.length > 0; else noContent">
        <div *ngFor="let video of contentVideos" class="video-item card">
          <div class="video-row">
            <div class="thumb" *ngIf="video.videoId || video.id">
              <img [src]="'https://img.youtube.com/vi/' + (video.videoId || video.id) + '/hqdefault.jpg'" alt="thumbnail">
            </div>
            <div class="meta" style="flex:1">
              <div class="video-title">
                <label>{{ video.videoTitle || video.title }}</label>
              </div>
              <div class="video-desc">
                <small>{{ video.description }}</small>
              </div>
              <div class="ratio ratio-16x9 mt-2">
                <iframe [src]="(video.videoUrl || video.url) | safe" frameborder="0" allowfullscreen></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noContent>
        <div class="card" style="padding:12px;">No content videos uploaded for this course yet.</div>
      </ng-template>
    </div>
  </div>

  <div *ngIf="activeTab==='assignments'">
    <div class="card-header">
      <h3>Assignments</h3>
    </div>
    <div class="card-list">
      <div *ngIf="assignments && assignments.length === 0" class="card" style="padding:12px;">
        No assignments available.
      </div>
      <div *ngFor="let assignment of assignments" class="assignment-row card">
        <div class="assignment-info">
          <div class="assignment-title">{{ assignment.title }}</div>
          <div class="assignment-desc">
            <strong>Questions:</strong>
            <ul style="margin: 8px 0; padding-left: 20px;">
              <li *ngFor="let q of assignment.questions">{{ q }}</li>
            </ul>
          </div>
        </div>
        <div class="assignment-meta">
          <div class="assignment-date">Due: {{ assignment.endDate }}</div>
          <button class="take-assignment-btn" (click)="takeAssignment(assignment)">Take Assignment</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'quiz'">
    <div class="card-header">
      <h3>Quizzes</h3>
    </div>
    <div class="card-list">
      <div *ngIf="!hasQuizzes()" class="card" style="padding:12px;">
        <p class="muted">No quizzes available.</p>
      </div>
      <div *ngFor="let quiz of quizzesList()" class="card" style="padding:16px; margin-bottom:12px;">
        <h4 style="margin-top: 0;">{{ quiz.questionTitle }}</h4>
        <p>{{ quiz.description || 'No description available.' }}</p>
        <p style="font-size: 14px;">Questions: {{ quiz.questions?.length || 0 }}</p>
        <button class="btn btn-primary" (click)="takeQuiz(quiz)">Take Quiz</button>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'progress'">
    <div class="card-header">
      <h3>My Progress</h3>
    </div>
    <div class="card" *ngIf="progress; else loadingProgress">
      <div class="progress-stats mb-3">
        <div class="d-flex justify-content-between">
          <span>
            <strong>{{ progress.completedTasks }}</strong> out of
            <strong>{{ progress.totalTasks }}</strong> items completed
          </span>
          <span class="percentage-label">{{ progress.percentage }}%</span>
        </div>
      </div>

      <div class="progress-bar-container">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill"
               [style.width.%]="progress.percentage || 0"
               [ngClass]="{
                 'low-progress': (progress.percentage || 0) < 40,
                 'mid-progress': (progress.percentage || 0) >= 40 && (progress.percentage || 0) < 100,
                 'complete-progress': (progress.percentage || 0) === 100
               }">
          </div>
        </div>
      </div>

      <div class="mt-4" style="color: #666; font-size: 0.9rem;">
        <p *ngIf="progress.percentage === 100">üéâ Congratulations! You have completed all course requirements.</p>
        <p *ngIf="progress.percentage !== undefined && progress.percentage < 100">
          Keep going! Complete your assignments and quizzes to reach 100%.
        </p>
      </div>
    </div>
    <ng-template #loadingProgress>
      <div class="card muted">Calculating your progress...</div>
    </ng-template>
  </div>
</div>
