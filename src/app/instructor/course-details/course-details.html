<div class="course-details">
  <div *ngIf="assignmentSuccessMessage" class="top-alert-success">
    {{ assignmentSuccessMessage }}
  </div>

  <button class="back-btn" (click)="goBack()">‚Üê Back to Courses</button>

  <h1>{{ course.title }}</h1>
  <p class="description">{{ course.description }}</p>

  <div class="publish-box">
    <span>Status:
      <strong [class.published]="course.published" [class.draft]="!course.published">
        {{ course.published ? 'Published' : 'Draft' }}
      </strong>
    </span>
    <button (click)="togglePublish()">
      {{ course.published ? 'Unpublish' : 'Publish Course' }}
    </button>
  </div>

  <div class="tabs">
    <button (click)="activeTab='content'" [class.active]="activeTab==='content'">Content</button>
    <button (click)="activeTab='assignments'" [class.active]="activeTab==='assignments'">Assignments</button>
    <button (click)="activeTab='resources'" [class.active]="activeTab==='resources'">Resources</button>
    <button (click)="activeTab='progress'" [class.active]="activeTab==='progress'">Progress</button>
    <button (click)="activeTab='quiz'" [class.active]="activeTab==='quiz'">Quiz</button>
  </div>

  <div *ngIf="activeTab==='assignments'">
    <div class="card-list">
      <div *ngFor="let assignment of courseDetailsService.assignments; let i = index" class="list-item">
        <span>{{assignment.title}} - Due: {{assignment.dueDate}}</span>
        <button class="btn-delete" (click)="deleteAssignment(i)">Delete</button>
      </div>
    </div>

    <div class="builder-section">
      <h4>Create New Assignment Questions</h4>
      <div class="input-row">
        <input type="text" [(ngModel)]="newQuestion" placeholder="Enter Assignment Question" />
        <button class="btn-primary" (click)="addQuestion()">Add Question</button>
      </div>
    </div>

    <ul class="question-list">
      <li *ngFor="let question of questions; let i = index">
        {{ question }}
        <button class="btn-delete-small" (click)="deleteAssignmentQuestion(i)">Delete</button>
      </li>
    </ul>

    <div *ngIf="questions.length > 0" class="finalize-action">
      <div class="date-input-group">
        <label>Last Date of Assignment Submit:</label>
        <input type="date" [(ngModel)]="assignmentDueDate" class="date-picker">
      </div>
      <button class="btn-success-large" (click)="addAssignmentToCourse()">
        Add Assignment to Course
      </button>
    </div>
  </div>

  <div *ngIf="activeTab === 'quiz'">

    <div *ngIf="isQuizAdded" class="card-list">
      <div class="list-item" style="border-left: 5px solid #16a34a; background: #f0fdf4; display: flex; justify-content: space-between; align-items: center;">
        <span>
          <strong>Course Quiz</strong> - {{ courseDetailsService.quiz.questions.length }} Questions
          <span *ngIf="quizDueDate"> (Due: {{quizDueDate}})</span>
        </span>
        <div style="display: flex; gap: 10px;">
          <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; height: auto;" (click)="resetQuizForm()">
            + Add New Quiz
          </button>
          <button class="btn-delete" (click)="deleteWholeQuiz()">Delete Whole Quiz</button>
        </div>
      </div>
    </div>

    <div class="quiz-form" *ngIf="!isQuizAdded">
      <input type="text" placeholder="Enter Question" [(ngModel)]="newQuestion">
      <div class="options-grid">
        <input type="text" placeholder="Option 1" [(ngModel)]="option1">
        <input type="text" placeholder="Option 2" [(ngModel)]="option2">
        <input type="text" placeholder="Option 3" [(ngModel)]="option3">
        <input type="text" placeholder="Option 4" [(ngModel)]="option4">
      </div>
      <input type="text" placeholder="Correct Answer" [(ngModel)]="correctOption">
      <button class="btn-primary" (click)="addQuizQuestion()">Add Question to Quiz</button>
    </div>

    <div class="quiz-list">
      <div *ngFor="let q of courseDetailsService.quiz.questions; let qi = index" class="quiz-question">
        <div style="display: flex; justify-content: space-between;">
          <strong>Q{{qi + 1}}: {{ q.split(' | ')[0] }}</strong>
          <button *ngIf="!isQuizAdded" (click)="deleteQuizQuestion(qi)" style="color: red; cursor: pointer; border:none; background:none; font-size: 12px;">
            Delete Question
          </button>
        </div>
        <p><strong>Correct:</strong> <span style="color: green;">{{ q.split(' | Correct: ')[1] }}</span></p>
      </div>
    </div>

    <div *ngIf="courseDetailsService.quiz.questions.length > 0 && !isQuizAdded" class="finalize-action">
      <div class="date-input-group">
        <label>Last Date of Quiz Submit:</label>
        <input type="date" [(ngModel)]="quizDueDate" class="date-picker">
      </div>
      <button class="btn-success-large" (click)="addQuizToPortal()">
        Add Quiz to Course
      </button>
    </div>
  </div>

</div>
